package com.hm.jp;

import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.URL;
import java.util.ArrayList;

import javax.net.ssl.HttpsURLConnection;
import javax.servlet.http.HttpServletRequest;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;

import com.hm.room.Hotel;

public class DAOJroom {

	public static void getAllroom(HttpServletRequest request) {
		
	try {
		String url= "https://api.visitjeju.net/vsjApi/contents/searchList?apiKey=x8uwubc8s4qzunfb&locale=kr&category=c3&page=";
		
		URL u = new URL(url);
		HttpsURLConnection huc = (HttpsURLConnection) u.openConnection();
		

		InputStream is = huc.getInputStream();
		InputStreamReader isr = new InputStreamReader(is, "utf-8");
		
		// jSON 데이터 받은거 파싱하게 jSONparser 객체가 필요
		JSONParser jp = new JSONParser();
				
		JSONObject room = (JSONObject) jp.parse(isr);
		
		JSONArray items = (JSONArray) jp.parse("items");
		ArrayList<Hotel_jp> hotels_jp = new ArrayList<Hotel_jp>();
		for (int i = 0; i < items.size(); i++) {
			JSONObject roomObj = (JSONObject) items.get(i);

			System.out.println(roomObj.get("title"));
			JSONObject a = (JSONObject) roomObj.get("repPhoto");
			JSONObject b = (JSONObject) a.get("photoid");

			String title = (String) roomObj.get("title");
			String address = (String) roomObj.get("address");
			String roadaddress = (String) roomObj.get("roadaddress");
			String introduction = (String) roomObj.get("introduction");
			String phoneno = (String) roomObj.get("phoneno");
			String imgpath = (String) b.get("imgpath");
			String thumnailpath = (String) b.get("thumnailpath");
			String tag = (String) roomObj.get("tag");
			String pk = (String) roomObj.get("contentsid");

			hotels_jp.add(new Hotel_jp(title, address, roadaddress, introduction, phoneno, imgpath, thumnailpath, tag, pk));
			}
		request.setAttribute("hotels_jp", hotels_jp);
			

		} catch (Exception e) {
			e.printStackTrace()
		}

	
		
	

	public static void roomPaging(int i, HttpServletRequest request) {
		// TODO Auto-generated method stub
		
	}

}
